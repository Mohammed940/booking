# دليل قاعدة البيانات الاحترافية للبوت الطبي

## مقدمة

تم تصميم قاعدة البيانات الاحترافية لتوفير نظام إدارة شامل لحجز المواعيد الطبية مع الميزات التالية:

1. **إدارة المراكز الصحية والعيادات**
2. **نظام متقدم للحجز مع تذكيرات تلقائية**
3. **لوحة تحكم إدارية شاملة**
4. **تتبع الحجوزات وإدارتها**
5. **توليد تقارير وإحصائيات**

## هيكل قاعدة البيانات

### الجداول الرئيسية

#### 1. جدول المراكز الصحية (medical_centers)
- **id**: المعرف الفريد للمركز
- **name**: اسم المركز الصحي
- **address**: عنوان المركز
- **phone**: رقم الهاتف
- **created_at**: تاريخ الإنشاء
- **updated_at**: تاريخ آخر تحديث

#### 2. جدول العيادات (clinics)
- **id**: المعرف الفريد للعيادة
- **name**: اسم العيادة
- **center_id**: معرف المركز التابع له (مرتبط بـ medical_centers)
- **description**: وصف العيادة
- **created_at**: تاريخ الإنشاء
- **updated_at**: تاريخ آخر تحديث

#### 3. جدول الأطباء (doctors) - اختياري
- **id**: المعرف الفريد للطبيب
- **name**: اسم الطبيب
- **clinic_id**: معرف العيادة التابع لها (مرتبط بـ clinics)
- **specialization**: التخصص
- **created_at**: تاريخ الإنشاء
- **updated_at**: تاريخ آخر تحديث

#### 4. جدول المواعيد المتاحة (time_slots)
- **id**: المعرف الفريد للموعد
- **clinic_id**: معرف العيادة (مرتبط بـ clinics)
- **doctor_id**: معرف الطبيب (مرتبط بـ doctors) - اختياري
- **date**: تاريخ الموعد
- **start_time**: وقت البدء
- **end_time**: وقت الانتهاء
- **duration**: مدة الموعد بالدقائق
- **is_available**: هل الموعد متاح؟
- **created_at**: تاريخ الإنشاء
- **updated_at**: تاريخ آخر تحديث

#### 5. جدول الحجوزات (appointments)
- **id**: المعرف الفريد للحجز
- **slot_id**: معرف الموعد المحجوز (مرتبط بـ time_slots)
- **patient_name**: اسم المريض
- **patient_age**: عمر المريض
- **patient_phone**: رقم هاتف المريض
- **patient_id_number**: رقم الهوية
- **chat_id**: معرف المحادثة في تيليجرام
- **status**: حالة الحجز (مؤكد، ملغي، مكتمل)
- **reminder_sent**: هل تم إرسال التذكير؟
- **created_at**: تاريخ الإنشاء
- **updated_at**: تاريخ آخر تحديث

#### 6. جدول تذكيرات الحجوزات (appointment_reminders)
- **id**: المعرف الفريد للتذكير
- **appointment_id**: معرف الحجز (مرتبط بـ appointments)
- **reminder_time**: وقت إرسال التذكير
- **is_sent**: هل تم إرسال التذكير؟
- **sent_at**: وقت إرسال التذكير الفعلي
- **created_at**: تاريخ الإنشاء

#### 7. جدول المستخدمين الإداريين (admin_users)
- **id**: المعرف الفريد للمستخدم
- **username**: اسم المستخدم
- **email**: البريد الإلكتروني
- **password_hash**: كلمة المرور مشفرة
- **role**: الصلاحية (مدير، مشرف)
- **is_active**: هل الحساب مفعل؟
- **last_login**: آخر تسجيل دخول
- **created_at**: تاريخ الإنشاء
- **updated_at**: تاريخ آخر تحديث

#### 8. جدول سجل العمليات الإدارية (admin_logs)
- **id**: المعرف الفريد للسجل
- **admin_id**: معرف المستخدم الإداري (مرتبط بـ admin_users)
- **action**: نوع العملية
- **table_name**: اسم الجدول المتأثر
- **record_id**: معرف السجل المتأثر
- **details**: تفاصيل العملية (JSON)
- **ip_address**: عنوان IP
- **created_at**: تاريخ العملية

## الميزات المتوفرة

### 1. ميزة التذكير التلقائي
- إرسال تذكير تلقائي قبل ساعتين من الموعد
- تتبع حالة إرسال التذكيرات
- إمكانية إعادة إرسال التذكيرات في حال الفشل

### 2. لوحة تحكم إدارية شاملة
- إضافة وتعديل المراكز الصحية
- إضافة وتعديل العيادات
- توليد المواعيد المتاحة للأشهر القادمة
- إدارة الحجوزات (تأكيد، إلغاء، تعديل)
- عرض تقارير وإحصائيات الحجوزات

### 3. نظام الحجز المتقدم
- حجز المواعيد عبر تيليجرام
- التحقق من توفر المواعيد
- إلغاء الحجوزات
- تتبع حالة الحجوزات

### 4. توليد التقارير
- تقرير الحجوزات حسب التاريخ
- تقرير الحجوزات حسب المركز والعيادة
- تقرير المرضى المتكررين
- إحصائيات الاستخدام

## كيفية استخدام النظام

### 1. تهيئة قاعدة البيانات
لإنشاء قاعدة البيانات الاحترافية مع البيانات التجريبية:

```bash
npm run init-professional-db
```

### 2. إضافة مركز صحي جديد
استخدام لوحة التحكم الإدارية لإضافة مراكز صحية جديدة.

### 3. إضافة عيادة لمركز
إمكانية إضافة عيادات متعددة لكل مركز صحي.

### 4. توليد المواعيد المتاحة
إنشاء مواعيد متاحة للأشهر القادمة لكل عيادة.

### 5. تشغيل خدمة التذكير
النظام يتحقق تلقائياً من وجود تذكيرات يجب إرسالها.

## الصيانة والتحديث

### النسخ الاحتياطي
يوصى بأخذ نسخ احتياطية دورية من قاعدة البيانات.

### التحديثات
يجب مراجعة الجداول والوظائف عند تحديث النظام.

## الأمان

### حماية البيانات
- جميع كلمات المرور مشفرة
- استخدام مفاتيح API آمنة
- تقييد الوصول للبيانات الحساسة

### سجل العمليات
يتم تسجيل جميع العمليات الإدارية لضمان الشفافية.

## الدعم الفني

في حالة وجود أي مشاكل أو استفسارات، يرجى التواصل مع فريق الدعم الفني.