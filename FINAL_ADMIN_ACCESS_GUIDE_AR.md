# دليل الوصول إلى لوحة الإدارة بعد النشر على Vercel

## الخطوات المطلوبة للوصول إلى لوحة الإدارة:

### 1. التأكد من إعداد المتغيرات البيئية
قبل الوصول إلى لوحة الإدارة، يجب التأكد من إعداد المتغيرات البيئية التالية في Vercel:

- `TELEGRAM_TOKEN` - رمز التيليجرام للبوت
- `SUPABASE_URL` - عنوان قاعدة بيانات Supabase
- `SUPABASE_KEY` - مفتاح الوصول إلى Supabase
- `ADMIN_CHAT_ID` - رقم تعريف المدير (موصى به للأمان)

### 2. النشر على Vercel
تأكد من أنك نشرت أحدث نسخة من الكود التي تحتوي على التحديثات التالية:
- تحديث ملف vercel.json لإصلاح مشكلة التوجيه
- تحديث ملف admin-panel.html لإضافة حقل إدخال معرف المدير
- تحديث ملف admin-api.js لتحسين التحقق من الهوية

### 3. الوصول إلى لوحة الإدارة
بعد نشر المشروع على Vercel، يمكنك الوصول إلى لوحة الإدارة من خلال:

1. زيارة الرابط الرئيسي للموقع: `https://your-vercel-url.vercel.app`
   - سيتم إعادة توجيهك تلقائيًا إلى لوحة الإدارة

2. أو زيارة الرابط المباشر: `https://your-vercel-url.vercel.app/admin-panel.html`

### 4. إعداد معرف المدير
للوصول إلى الوظائف الإدارية، تحتاج إلى إعداد معرف المدير:

1. افتح تطبيق Telegram
2. ابدأ محادثة مع بوتك
3. أرسل الأمر `/start` 
4. سيرسل لك البوت معرف المحادثة (Chat ID)
5. انسخ هذا المعرف وأدخله في حقل "معرف المدير" في لوحة الإدارة
6. انقر على "حفظ المعرف"

### 5. حل مشكلة "404: NOT_FOUND"
إذا ظهرت لك رسالة "404: NOT_FOUND" عند محاولة الوصول إلى لوحة الإدارة:

1. تأكد من أنك نشرت أحدث نسخة من الكود
2. تحقق من أن ملف vercel.json يحتوي على التوجيهات الصحيحة:
   ```json
   {
     "version": 2,
     "builds": [
       {
         "src": "api/bot.js",
         "use": "@vercel/node"
       }
     ],
     "routes": [
       {
         "src": "/webhook",
         "dest": "/api/bot"
       },
       {
         "src": "/api/bot",
         "dest": "/api/bot.js"
       },
       {
         "src": "/api/admin/(.*)",
         "dest": "/api/bot.js"
       },
       {
         "src": "/api/reminders/(.*)",
         "dest": "/api/bot.js"
       },
       {
         "src": "/admin-panel.html",
         "dest": "/api/bot.js"
       },
       {
         "src": "/",
         "dest": "/api/bot.js"
       },
       {
         "src": "/health",
         "dest": "/api/bot.js"
       }
     ]
   }
   ```

3. أعد نشر المشروع على Vercel

### 6. حل مشكلة "Unauthorized access"
إذا ظهرت لك رسالة "Unauthorized access" عند محاولة الوصول إلى واجهة برمجة التطبيقات الإدارية:

1. تأكد من أنك أدخلت معرف المدير في لوحة الإدارة
2. تحقق من أن ADMIN_CHAT_ID في إعدادات Vercel يتطابق مع معرف المحادثة
3. إذا كنت لا تريد تعيين ADMIN_CHAT_ID في Vercel (للتطوير)، فتأكد من إدخال المعرف في لوحة الإدارة

### 7. استخدام واجهة برمجة التطبيقات الإدارية
يمكنك أيضًا استخدام واجهة برمجة التطبيقات الإدارية مباشرة من خلال إرسال طلبات HTTP إلى النقاط التالية:

- إضافة مركز طبي: `POST /api/admin/centers?adminId=YOUR_ADMIN_ID`
- إضافة عيادة: `POST /api/admin/clinics?adminId=YOUR_ADMIN_ID`
- إضافة فترات زمنية: `POST /api/admin/slots?adminId=YOUR_ADMIN_ID`
- الحصول على جميع المراكز: `GET /api/admin/centers?adminId=YOUR_ADMIN_ID`
- الحصول على العيادات في مركز معين: `GET /api/admin/clinics/:centerName?adminId=YOUR_ADMIN_ID`
- الحصول على المواعيد: `GET /api/admin/appointments?adminId=YOUR_ADMIN_ID`

### 8. استكشاف الأخطاء وإصلاحها
إذا استمرت المشاكل:

1. تحقق من سجلات Vercel للبحث عن الأخطاء
2. تأكد من أن جميع المتغيرات البيئية مضبوطة بشكل صحيح
3. تحقق من أن بيانات اعتماد Supabase صحيحة ولها الأذونات المناسبة
4. تأكد من إنشاء جداول قاعدة البيانات بشكل صحيح باستخدام ملف DATABASE_SCHEMA.sql

### 9. الأمان
للحصول على أقصى قدر من الأمان:
1. قم بتعيين ADMIN_CHAT_ID في إعدادات Vercel
2. لا تشارك معرف المدير مع الآخرين
3. استخدم كلمة مرور قوية لحساب Supabase الخاص بك
4. قم بتحديث المتغيرات البيئية بانتظام