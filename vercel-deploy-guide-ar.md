# دليل نشر البوت على منصة Vercel

## المتطلبات الأساسية

1. حساب على منصة Vercel
2. التأكد من إعداد متغيرات البيئة بشكل صحيح
3. التأكد من صحة بيانات اعتماد Google Sheets

## خطوات النشر

### 1. إعداد متغيرات البيئة

في إعدادات المشروع على Vercel، قم بإضافة المتغيرات التالية:

```
TELEGRAM_TOKEN=رمز_البوت_الخاص_بك
SPREADSHEET_ID=معرف_جدول_البيانات_في_جوجل_شيت
GOOGLE_APPLICATION_CREDENTIALS_BASE64=بيانات_اعتماد_جوجل_مشفرة_بصيغة_base64
ADMIN_CHAT_ID=معرف_المحادثة_الخاصة_بالمسؤول
NODE_ENV=production
```

### 2. نشر المشروع

1. ارفع الكود إلى مستودع GitHub أو GitLab أو Bitbucket
2. قم بتوصيل المستودع مع Vercel
3. حدد الأمر التالي كأمر للبناء: `npm install`
4. حدد الدليل الجذر كدليل الإخراج
5. قم بإضافة جميع متغيرات البيئة المذكورة أعلاه
6. اضغط على نشر المشروع

### 3. إعداد Webhook للتليجرام

بعد اكتمال النشر:

1. احصل على رابط النشر من Vercel (مثلاً: `https://اسم-المشروع.vercel.app`)
2. قم بإعداد webhook للبوت باستخدام الأمر التالي:

```bash
curl -F "url=https://اسم-المشروع.vercel.app/api/bot" https://api.telegram.org/bot<رمز_البوت>/setWebhook
```

أو استخدم الأمر المخصص في المشروع:
```bash
# قم بتعيين متغير البيئة VERCEL_URL أولاً
npm run setup-webhook
```

## حل المشاكل الشائعة

### البطء في استجابة البوت أو الاستجابة المتعددة

هذه المشكلة تحدث عادة بسبب:

1. معالجة الرسائل المكررة
2. تشغيل عدة نسخ من البوت في نفس الوقت
3. إعداد Webhook غير صحيح

### إعدادات التخزين المؤقت

البوت يستخدم نظام تخزين مؤقت لتحسين الأداء:
- تخزين مراكز الصحة والعيادات: دقيقتان
- تخزين المواعيد المتاحة: دقيقتان

هذا يقلل عدد طلبات API الخاصة بجوجل شيت ويحسن زمن الاستجابة.

### إذا استمرت المشكلة

1. تحقق من سجلات Vercel بحثًا عن الأخطاء
2. تأكد من صحة إعداد متغيرات البيئة
3. تحقق من أن بيانات اعتماد جوجل شيت تملك الصلاحيات اللازمة
4. تأكد من صحة معرف جدول البيانات